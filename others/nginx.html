<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nginx服务器搭建 | Xiao Blog</title>
    <meta name="description" content="">
    <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/31.styles.72922159.css" as="style"><link rel="preload" href="/assets/js/app.a03d4e4f.js" as="script"><link rel="preload" href="/assets/js/16.ece38f4c.js" as="script"><link rel="prefetch" href="/assets/js/0.0f59b883.js"><link rel="prefetch" href="/assets/js/1.9796cf5f.js"><link rel="prefetch" href="/assets/js/2.2a946d02.js"><link rel="prefetch" href="/assets/js/3.59a83de8.js"><link rel="prefetch" href="/assets/js/4.21fdbdec.js"><link rel="prefetch" href="/assets/js/5.a09ec324.js"><link rel="prefetch" href="/assets/js/6.d6543f82.js"><link rel="prefetch" href="/assets/js/7.3de0ccee.js"><link rel="prefetch" href="/assets/js/8.88711e9b.js"><link rel="prefetch" href="/assets/js/9.338fb1f3.js"><link rel="prefetch" href="/assets/js/10.538a23d4.js"><link rel="prefetch" href="/assets/js/11.55badfb5.js"><link rel="prefetch" href="/assets/js/12.6f950838.js"><link rel="prefetch" href="/assets/js/13.5399a19b.js"><link rel="prefetch" href="/assets/js/14.451eca1f.js"><link rel="prefetch" href="/assets/js/15.35ff6acf.js"><link rel="prefetch" href="/assets/js/17.3bcb6de9.js"><link rel="prefetch" href="/assets/js/18.74c09d5d.js"><link rel="prefetch" href="/assets/js/19.aa302882.js"><link rel="prefetch" href="/assets/js/20.d26e17c2.js"><link rel="prefetch" href="/assets/js/21.140f1446.js"><link rel="prefetch" href="/assets/js/22.d56b6200.js"><link rel="prefetch" href="/assets/js/23.c0b205ad.js"><link rel="prefetch" href="/assets/js/24.e3ca6758.js"><link rel="prefetch" href="/assets/js/25.5bbdea6c.js"><link rel="prefetch" href="/assets/js/26.15fba687.js"><link rel="prefetch" href="/assets/js/27.36d4982c.js"><link rel="prefetch" href="/assets/js/28.ef10919f.js"><link rel="prefetch" href="/assets/js/29.1fd2d94f.js"><link rel="prefetch" href="/assets/js/30.152778aa.js">
    <link rel="stylesheet" href="/assets/css/31.styles.72922159.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Xiao Blog
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><!----></div></header><div class="sidebar-mask"></div><div class="sidebar"><!----><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>JavaScript</span><!----></p><ul class="sidebar-group-items"><li><a href="/javascript/" class="sidebar-link">前端缓存</a></li><li><a href="/javascript/partner.html" class="sidebar-link">设计模式</a></li><li><a href="/javascript/canvas.html" class="sidebar-link">canvas踩坑记</a></li><li><a href="/javascript/listview.html" class="sidebar-link">List-view 实现</a></li><li><a href="/javascript/typescript.html" class="sidebar-link">Typescript</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Vue</span><!----></p><ul class="sidebar-group-items"><li><a href="/vue/" class="sidebar-link">Vuex学习笔记</a></li><li><a href="/vue/vuex-persistence.html" class="sidebar-link">Vuex 持久化方案一</a></li><li><a href="/vue/vueMultipage.html" class="sidebar-link">vue多页配置</a></li><li><a href="/vue/optimize.html" class="sidebar-link">vue项目优化</a></li><li><a href="/vue/parcel-vue.html" class="sidebar-link">parcel-vue初体验</a></li><li><a href="/vue/sync-component.html" class="sidebar-link">异步组件</a></li><li><a href="/vue/rebuild.html" class="sidebar-link">重构Vue阅读器</a></li><li><a href="/vue/vue-tsx.html" class="sidebar-link">搭建vue-tsx风格的开发模板</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>WebApp</span><!----></p><ul class="sidebar-group-items"><li><a href="/webapp/" class="sidebar-link">cordova 打包</a></li><li><a href="/webapp/questions.html" class="sidebar-link">移动端问题锦集</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Flutter</span><!----></p><ul class="sidebar-group-items"><li><a href="/flutter/" class="sidebar-link">环境搭建</a></li><li><a href="/flutter/dart.html" class="sidebar-link">Dart基础语法</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Services</span><!----></p><ul class="sidebar-group-items"><li><a href="/services/" class="sidebar-link">Mongodb 好像有点意思？</a></li><li><a href="/services/mongodb.html" class="sidebar-link">正经学个mongoDB吧！</a></li><li><a href="/services/python.html" class="sidebar-link">学学Python吧~</a></li><li><a href="/services/mysql.html" class="sidebar-link">向mysql低头</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>其他</span><!----></p><ul class="sidebar-group-items"><li><a href="/others/" class="sidebar-link">VSCode 常用插件推荐</a></li><li><a href="/others/vsESlint.html" class="sidebar-link">VSCode ESLint 配置</a></li><li><a href="/others/nginx.html" class="active sidebar-link">nginx服务器搭建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/others/nginx.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/others/nginx.html#搭建" class="sidebar-link">搭建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/others/nginx.html#nginx-安装" class="sidebar-link">nginx 安装</a></li><li class="sidebar-sub-header"><a href="/others/nginx.html#配置-https" class="sidebar-link">配置 https</a></li></ul></li></ul></li><li><a href="/others/android-dev.html" class="sidebar-link">Mac 配置 Android 环境</a></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="nginx-服务器搭建"><a href="#nginx-服务器搭建" aria-hidden="true" class="header-anchor">#</a> nginx 服务器搭建</h1><h2 id="前言"><a href="#前言" aria-hidden="true" class="header-anchor">#</a> 前言</h2><p>之前不知道是因为腾讯云出了 bug 还是咋的，已经毕业的学生证还是可以在腾讯云上购买学生套餐，于是花了 300 不到买了 3 年的服务器，买完之后就搁置在一盘没有怎么用了。</p><p>最近有想法弄点自己的小东西，需要挂载到服务器上，于是就拿出了尘封已久的服务器，搭建下环境了，也好了解下怎么简单的搭建服务器。</p><h2 id="搭建"><a href="#搭建" aria-hidden="true" class="header-anchor">#</a> 搭建</h2><h3 id="nginx-安装"><a href="#nginx-安装" aria-hidden="true" class="header-anchor">#</a> nginx 安装</h3><p>通过阿里云控制台登录控制台，或者通过本地<code>ssh</code>登录服务器：</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">ssh</span> root@server <span class="token comment"># server 是你服务器的ip地址</span>
</code></pre></div><p>之后会让输入密码，输入之后就登录成功了。</p><p>然后我们安装<code>nginx</code>，通过<code>yum</code>命令安装：</p><div class="language-bash extra-class"><pre class="language-bash"><code>yum <span class="token function">install</span> -y nginx
</code></pre></div><p>等待一会后，nginx 就安装上了，然后我们启动<code>nginx</code>：</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">service</span> nginx start
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">其他命令</p><p><code>service nginx restart</code> # 重启<code>nginx</code>服务
<code>service nginx stop</code> # 停止<code>nginx</code>服务</p></div><p>然后打开浏览器，输入服务器的 ip 地址，如果出现以下界面就表示成功了：</p><img src="/assets/nginx.png"><p>是不是很简单？</p><h3 id="配置-https"><a href="#配置-https" aria-hidden="true" class="header-anchor">#</a> 配置 https</h3><p>之所以想配置<code>https</code>是因为以下几点：</p><ul><li>安全</li><li>利于 SEO</li><li>防劫持</li></ul><p>因为穷，没钱购买 ssl 安全证书。。。只好用免费的了。。。这里使用的是<code>certbot-auto</code>免费生成密钥。</p><p>首先安装<code>certbot-auto</code>：</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">wget</span> https://dl.eff.org/certbot-auto
</code></pre></div><p>安装结束后，我们修改下<code>certbot-auto</code>所在目录的权限并暂时关闭<code>nginx</code>服务：</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">chown</span> a+x ./certbot-auto
<span class="token function">service</span> nginx stop
</code></pre></div><p>然后我们使用<code>certbot-auto</code>生成证书，生成证书有两种模式：</p><ul><li>standalone</li><li>webroot</li></ul><div class="tip custom-block"><p class="custom-block-title">区别</p><p>使用<code>standalone</code>模式生成的证书，如果到期后，更新证书需要重启服务，而<code>webroot</code>模式不需要，因为<code>webroot</code>模式会在项目目录下生成一个隐藏的文件，并且通过这个隐藏文件来验证，所以到期更新证书的时候不需要重启服务。</p></div><blockquote><p>使用 standalone 生成证书</p></blockquote><div class="language-bash extra-class"><pre class="language-bash"><code>./certbot-auto certonly --standalone --email 邮箱地址 -d 域名1
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">提示</p><p>如果多个域名，直接后面接连跟着 -d 域名地址，比如:<code>./certbot-auto certonly --standalone -d 域名1 -d 域名2</code></p></div><blockquote><p>使用 webroot 生成证书</p></blockquote><div class="language-bash extra-class"><pre class="language-bash"><code>./certbot-auto certonly --webroot --email 邮箱地址 -w 项目地址 -d 域名1 -d 域名2
</code></pre></div><p>生成后的证书会存在<code>/etc/letsencrypt/live/你的域名/</code>这个目录中。</p><p>最后一步就是配置<code>nginx</code>：</p><div class="language-bash extra-class"><pre class="language-bash"><code>vim /etc/nginx/nginx.conf  <span class="token comment"># 打开nginx的配置文件</span>
</code></pre></div><p>在<code>server</code>中配置<code>ssl</code>：</p><div class="language-bash extra-class"><pre class="language-bash"><code>server <span class="token punctuation">{</span>
    listen       443 ssl http2 default_server<span class="token punctuation">;</span>
    listen       <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:443 ssl http2 default_server<span class="token punctuation">;</span>
    server_name  www.weixiaomu.com weixiaomu.com<span class="token punctuation">;</span> <span class="token comment"># 域名绑定</span>
    root         /var/www/html/blog<span class="token punctuation">;</span>  <span class="token comment"># 项目目录</span>

    <span class="token comment"># 证书配置</span>
    ssl on<span class="token punctuation">;</span>
    ssl_certificate <span class="token string">&quot;/etc/letsencrypt/live/www.weixiaomu.com/fullchain.pem&quot;</span><span class="token punctuation">;</span>
    ssl_certificate_key <span class="token string">&quot;/etc/letsencrypt/live/www.weixiaomu.com/privkey.pem&quot;</span><span class="token punctuation">;</span>

    <span class="token comment"># Load configuration files for the default server block.</span>
    include /etc/nginx/default.d/*.conf<span class="token punctuation">;</span>

    location / <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>配置好后使用<code>service nginx start</code>重启<code>nginx</code>就可以了。</p><p>这样我们访问<a href="https://www.weixiaomu.com" target="_blank" rel="noopener noreferrer">https://www.weixiaomu.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>或者<a href="https://weixiaomu.com" target="_blank" rel="noopener noreferrer">https://weixiaomu.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>就是变成https了。</p><p>效果图如下：</p><img src="/assets/https.png"><p>但是，如果我想普通访问域名时自动跳到https下该怎么设置？</p><p>不难，我们在<code>nginx</code>配置文件中，新建立一个<code>server</code>，当访问<code>http</code>的时候，重定向到<code>https</code>即可：</p><div class="language-bash extra-class"><pre class="language-bash"><code>server <span class="token punctuation">{</span>
    listen  80<span class="token punctuation">;</span>
    server_name     weixiaomu.com<span class="token punctuation">;</span>
    <span class="token keyword">return</span>  301 https://<span class="token variable">$server_name</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后重启下<code>nginx</code>就可以了。</p></div><div class="page-edit"><!----><div class="last-updated"><span class="prefix">上次更新: </span><span class="time">8/31/2018, 5:52:20 PM</span></div></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/others/vsESlint.html" class="prev">
          VSCode ESLint 配置
        </a></span><span class="next"><a href="/others/android-dev.html">
          Mac 配置 Android 环境
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/16.ece38f4c.js" defer></script><script src="/assets/js/app.a03d4e4f.js" defer></script>
  </body>
</html>
