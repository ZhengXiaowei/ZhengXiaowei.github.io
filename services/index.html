<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mongodb 好像有点意思？ | Xiao Blog</title>
    <meta name="description" content="">
    <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/31.styles.72922159.css" as="style"><link rel="preload" href="/assets/js/app.a03d4e4f.js" as="script"><link rel="preload" href="/assets/js/14.451eca1f.js" as="script"><link rel="prefetch" href="/assets/js/0.0f59b883.js"><link rel="prefetch" href="/assets/js/1.9796cf5f.js"><link rel="prefetch" href="/assets/js/2.2a946d02.js"><link rel="prefetch" href="/assets/js/3.59a83de8.js"><link rel="prefetch" href="/assets/js/4.21fdbdec.js"><link rel="prefetch" href="/assets/js/5.a09ec324.js"><link rel="prefetch" href="/assets/js/6.d6543f82.js"><link rel="prefetch" href="/assets/js/7.3de0ccee.js"><link rel="prefetch" href="/assets/js/8.88711e9b.js"><link rel="prefetch" href="/assets/js/9.338fb1f3.js"><link rel="prefetch" href="/assets/js/10.538a23d4.js"><link rel="prefetch" href="/assets/js/11.55badfb5.js"><link rel="prefetch" href="/assets/js/12.6f950838.js"><link rel="prefetch" href="/assets/js/13.5399a19b.js"><link rel="prefetch" href="/assets/js/15.35ff6acf.js"><link rel="prefetch" href="/assets/js/16.ece38f4c.js"><link rel="prefetch" href="/assets/js/17.3bcb6de9.js"><link rel="prefetch" href="/assets/js/18.74c09d5d.js"><link rel="prefetch" href="/assets/js/19.aa302882.js"><link rel="prefetch" href="/assets/js/20.d26e17c2.js"><link rel="prefetch" href="/assets/js/21.140f1446.js"><link rel="prefetch" href="/assets/js/22.d56b6200.js"><link rel="prefetch" href="/assets/js/23.c0b205ad.js"><link rel="prefetch" href="/assets/js/24.e3ca6758.js"><link rel="prefetch" href="/assets/js/25.5bbdea6c.js"><link rel="prefetch" href="/assets/js/26.15fba687.js"><link rel="prefetch" href="/assets/js/27.36d4982c.js"><link rel="prefetch" href="/assets/js/28.ef10919f.js"><link rel="prefetch" href="/assets/js/29.1fd2d94f.js"><link rel="prefetch" href="/assets/js/30.152778aa.js">
    <link rel="stylesheet" href="/assets/css/31.styles.72922159.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Xiao Blog
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><!----></div></header><div class="sidebar-mask"></div><div class="sidebar"><!----><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>JavaScript</span><!----></p><ul class="sidebar-group-items"><li><a href="/javascript/" class="sidebar-link">前端缓存</a></li><li><a href="/javascript/partner.html" class="sidebar-link">设计模式</a></li><li><a href="/javascript/canvas.html" class="sidebar-link">canvas踩坑记</a></li><li><a href="/javascript/listview.html" class="sidebar-link">List-view 实现</a></li><li><a href="/javascript/typescript.html" class="sidebar-link">Typescript</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Vue</span><!----></p><ul class="sidebar-group-items"><li><a href="/vue/" class="sidebar-link">Vuex学习笔记</a></li><li><a href="/vue/vuex-persistence.html" class="sidebar-link">Vuex 持久化方案一</a></li><li><a href="/vue/vueMultipage.html" class="sidebar-link">vue多页配置</a></li><li><a href="/vue/optimize.html" class="sidebar-link">vue项目优化</a></li><li><a href="/vue/parcel-vue.html" class="sidebar-link">parcel-vue初体验</a></li><li><a href="/vue/sync-component.html" class="sidebar-link">异步组件</a></li><li><a href="/vue/rebuild.html" class="sidebar-link">重构Vue阅读器</a></li><li><a href="/vue/vue-tsx.html" class="sidebar-link">搭建vue-tsx风格的开发模板</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>WebApp</span><!----></p><ul class="sidebar-group-items"><li><a href="/webapp/" class="sidebar-link">cordova 打包</a></li><li><a href="/webapp/questions.html" class="sidebar-link">移动端问题锦集</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Flutter</span><!----></p><ul class="sidebar-group-items"><li><a href="/flutter/" class="sidebar-link">环境搭建</a></li><li><a href="/flutter/dart.html" class="sidebar-link">Dart基础语法</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Services</span><!----></p><ul class="sidebar-group-items"><li><a href="/services/" class="active sidebar-link">Mongodb 好像有点意思？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/services/#mongodb" class="sidebar-link">mongodb</a></li><li class="sidebar-sub-header"><a href="/services/#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/services/#简单使用" class="sidebar-link">简单使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/services/#创建-选择数据库" class="sidebar-link">创建/选择数据库</a></li><li class="sidebar-sub-header"><a href="/services/#插入数据" class="sidebar-link">插入数据</a></li><li class="sidebar-sub-header"><a href="/services/#删除数据库" class="sidebar-link">删除数据库</a></li><li class="sidebar-sub-header"><a href="/services/#创建数据集合-也就是数据表" class="sidebar-link">创建数据集合(也就是数据表)</a></li><li class="sidebar-sub-header"><a href="/services/#删除数据集合-表" class="sidebar-link">删除数据集合(表)</a></li><li class="sidebar-sub-header"><a href="/services/#插入数据-2" class="sidebar-link">插入数据</a></li><li class="sidebar-sub-header"><a href="/services/#数据更新" class="sidebar-link">数据更新</a></li><li class="sidebar-sub-header"><a href="/services/#删除文档" class="sidebar-link">删除文档</a></li><li class="sidebar-sub-header"><a href="/services/#查询文档" class="sidebar-link">查询文档</a></li><li class="sidebar-sub-header"><a href="/services/#排序" class="sidebar-link">排序</a></li><li class="sidebar-sub-header"><a href="/services/#索引" class="sidebar-link">索引</a></li><li class="sidebar-sub-header"><a href="/services/#聚合" class="sidebar-link">聚合</a></li></ul></li></ul></li><li><a href="/services/mongodb.html" class="sidebar-link">正经学个mongoDB吧！</a></li><li><a href="/services/python.html" class="sidebar-link">学学Python吧~</a></li><li><a href="/services/mysql.html" class="sidebar-link">向mysql低头</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>其他</span><!----></p><ul class="sidebar-group-items"><li><a href="/others/" class="sidebar-link">VSCode 常用插件推荐</a></li><li><a href="/others/vsESlint.html" class="sidebar-link">VSCode ESLint 配置</a></li><li><a href="/others/nginx.html" class="sidebar-link">nginx服务器搭建</a></li><li><a href="/others/android-dev.html" class="sidebar-link">Mac 配置 Android 环境</a></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="初识mongodb"><a href="#初识mongodb" aria-hidden="true" class="header-anchor">#</a> 初识<code>Mongodb</code></h1><h2 id="mongodb"><a href="#mongodb" aria-hidden="true" class="header-anchor">#</a><code>mongodb</code></h2><p>简单来说<code>mongodb</code>是一个数据库系统，它和<code>sql</code>、<code>mysql</code>的区别在于，它是一个<strong>非关系型</strong>数据库系统，它能将数据存储为以<code>key=&gt;value</code>的形式，类似于我们常用的<code>JSON</code>对象。一是这样操作起来方便，二也大大提高了数据存储的性能。</p><div class="warning custom-block"><p class="custom-block-title">注意</p><p>以上只是我自己的一些粗浅的见解。</p></div><h2 id="安装"><a href="#安装" aria-hidden="true" class="header-anchor">#</a> 安装</h2><div class="tip custom-block"><p class="custom-block-title">提示</p><p>安装环境：Mac</p></div><p>直接使用<code>brew</code>安装：</p><div class="language-bash extra-class"><pre class="language-bash"><code>brew <span class="token function">install</span> mongodb
</code></pre></div><p>如果需要安装指定版本的<code>mongodb</code>，直接在后面注明版本号即可：</p><div class="language-bash extra-class"><pre class="language-bash"><code>brew <span class="token function">install</span> mongodb@3.4
</code></pre></div><p>启动<code>mongodb</code>服务：</p><div class="language-bash extra-class"><pre class="language-bash"><code>brew services start mongodb <span class="token comment"># 启动服务</span>
brew services stop mongodb  <span class="token comment"># 关闭服务</span>
</code></pre></div><h2 id="简单使用"><a href="#简单使用" aria-hidden="true" class="header-anchor">#</a> 简单使用</h2><p>直接使用命令<code>mongo</code>即可进入数据库，如下：</p><img src="/assets/mongodb/init_mongodb.png"><p>其中有告诉我们连接的是哪个服务，比如上图中的<code>connecting to: mongodb://127.0.0.1:27017</code></p><p>接下来我们可以使用<code>db</code>、<code>show dbs</code>来查看当前有哪些数据库，这个自行操作即可。</p><h3 id="创建-选择数据库"><a href="#创建-选择数据库" aria-hidden="true" class="header-anchor">#</a> 创建/选择数据库</h3><p>使用命令<code>use databaseName</code>即可选择已有的数据库，如果该库不存在，则会创建。</p><div class="language-bash extra-class"><pre class="language-bash"><code>use dbDemo
</code></pre></div><p>创建成功后，可以使用<code>show dbs</code>查看已经创建的数据库。</p><div class="warning custom-block"><p class="custom-block-title">警告</p><p>如果新创建的数据库没有数据的话，则不会显示在<code>show dbs</code>的列表中。</p></div><h3 id="插入数据"><a href="#插入数据" aria-hidden="true" class="header-anchor">#</a> 插入数据</h3><p>可以直接使用<code>insert</code>命令完成数据插入的操作：</p><div class="language-bash extra-class"><pre class="language-bash"><code>db.dbDemo.insert<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token keyword">:</span><span class="token string">&quot;我是dbDemo数据库中的第一条数据&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 成功后会提示 WriteResult({&quot;nInserted&quot;:1}) 表示成功插入了一跳数据</span>
</code></pre></div><h3 id="删除数据库"><a href="#删除数据库" aria-hidden="true" class="header-anchor">#</a> 删除数据库</h3><p>删除数据库可使用命令<code>db.dropDatabase()</code>操作：</p><div class="language-bash extra-class"><pre class="language-bash"><code>use dbDemo <span class="token comment"># 选择进入dbDemo数据库</span>
db.dropDatabase<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 执行删除命令</span>

show dbs <span class="token comment"># 显示已有数据库</span>

<span class="token comment"># 删除成功会提示 {&quot;dropped&quot;:&quot;dbDemo&quot;,&quot;ok&quot;:1} 并会发现dbDemo也不在数据库列表里了</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">警告</p><p>删除数据库前<strong>必须先进入要删除的数据库</strong>才能进行！！！</p></div><h3 id="创建数据集合-也就是数据表"><a href="#创建数据集合-也就是数据表" aria-hidden="true" class="header-anchor">#</a> 创建数据集合(也就是数据表)</h3><p>要创建数据集合有两种方式：</p><ul><li>使用<code>db.createCollection(name, option)</code></li><li>直接使用<code>db.database.insert()</code>插入数据的时候创建</li></ul><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 第一种方式</span>
use dbDemo <span class="token comment"># 选择数据库</span>
db.createCollection<span class="token punctuation">(</span><span class="token string">'table1'</span><span class="token punctuation">)</span> <span class="token comment"># 创建一个名为table1的数据集合(表)</span>

<span class="token comment"># {&quot;ok&quot;:1} 成功创建一行</span>

<span class="token comment"># 第二种方式</span>
db.table2.insert<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token keyword">:</span><span class="token string">&quot;我是table2中的数据&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment"># table2不存在 故直接创建并插入一条数据</span>

<span class="token comment"># WriteResult({&quot;nInserted&quot;:1})</span>
</code></pre></div><p>通过命令<code>show tables</code>或者<code>show collections</code>查看创建出的数据集合(表)</p><p>使用<code>db.createCollection(name, option)</code>的可选<code>option</code>如下：</p><table><thead><tr><th>字段</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>capped</td><td>Boolean</td><td>(可选)如果为 true，则创建固定集合。固定集合是指有着固定大小的集合，当达到最大值时，它会自动覆盖最早的文档。当该值为 true 时，必须指定 size 参数。</td></tr><tr><td>autoIndexId</td><td>Boolean</td><td>(可选)如为 true，自动在 _id 字段创建索引。默认为 false。</td></tr><tr><td>size</td><td>Number</td><td>(可选)为固定集合指定一个最大值（以字节计）。如果 capped 为 true，也需要指定该字段。</td></tr><tr><td>max</td><td>Number</td><td>(可选)指定固定集合中包含文档的最大数量。</td></tr></tbody></table><h3 id="删除数据集合-表"><a href="#删除数据集合-表" aria-hidden="true" class="header-anchor">#</a> 删除数据集合(表)</h3><p>使用命令<code>db.table.drop()</code>即可删除：</p><div class="language-bash extra-class"><pre class="language-bash"><code>use dbDemo <span class="token comment"># 选择数据库</span>
db.table2.drop<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 删除table2</span>

show tables
<span class="token comment"># 会发现table2已经没了</span>
</code></pre></div><h3 id="插入数据-2"><a href="#插入数据-2" aria-hidden="true" class="header-anchor">#</a> 插入数据</h3><p>插入数据的写法有四种：</p><ul><li><code>db.table.insert(obj|array)</code> 可插入单条也可以插入多条</li><li><code>db.table.insertOne(obj)</code> 插入单条数据</li><li><code>db.table.insertMany(array)</code> 插入多条数据</li><li><code>db.table.save(obj)</code> 这种写法如果不指定 id 的情况下，就是执行插入操作；如果指定 id 了，则执行更新操作</li></ul><h3 id="数据更新"><a href="#数据更新" aria-hidden="true" class="header-anchor">#</a> 数据更新</h3><p>更新数据可以使用<code>db.table.update</code>和<code>db.table.save</code>两种方式进行更新。</p><p><code>db.table.update</code>：</p><div class="language-bash extra-class"><pre class="language-bash"><code>db.table.update<span class="token punctuation">(</span>
  condition,
  update,
  <span class="token punctuation">{</span>
    upsert: Boolean,
    multi: Boolean,
    writeConcern: Document
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><p>参数说明：</p><ul><li><strong>condition</strong>: 查询条件</li><li><strong>update</strong>: 更新内容，会带有一些操作符例如$set,$inc 之类的</li><li><strong>upsert</strong>: 记录不存在的情况下是否执行插入操作，默认<code>false</code></li><li><strong>multi</strong>: 是否查询全部，默认<code>false</code></li><li>writeConcern: 报错时抛出错误的级别，了解即可</li></ul><p>来个例子，我们先插入一条数据，然后再更新这条数据：</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 插入一条张三的信息</span>
db.table.insert<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token keyword">:</span><span class="token string">'张三'</span>, <span class="token string">'age'</span><span class="token keyword">:</span> 23<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 更新张三的名称，将张三的名字改为李四</span>
db.table.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token keyword">:</span><span class="token string">'张三'</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$set</span><span class="token keyword">:</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token keyword">:</span><span class="token string">'李四'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># WriteResult({&quot;nMatched&quot;: 1, &quot;nUpserted&quot;: 0, &quot;nModified&quot;: 1}) 更新成功输出信息</span>
</code></pre></div><p><code>db.table.save</code>：</p><div class="language-bash extra-class"><pre class="language-bash"><code>db.table.save<span class="token punctuation">(</span>
  document,
  <span class="token punctuation">{</span>
    writeConcern: document
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><p>参数说明：</p><ul><li><strong>document</strong>: 文档数据</li><li>writeConcern: 报错时抛出错误的级别，了解即可</li></ul><p>举个例子：</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 更新李四的数据为张三</span>

db.table.save<span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'_id'</span><span class="token keyword">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">&quot;56064f89ade2f21f36b03136&quot;</span><span class="token punctuation">)</span>,
  <span class="token string">'name'</span><span class="token keyword">:</span> <span class="token string">'张三'</span>,
  <span class="token string">'age'</span><span class="token keyword">:</span> 23
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="删除文档"><a href="#删除文档" aria-hidden="true" class="header-anchor">#</a> 删除文档</h3><p>删除文档的方法：</p><ul><li><code>db.table.deleteMany(condition)</code> 删除符合条件的多条记录</li><li><code>db.table.deleteOne(condition)</code> 删除符合条件的第一条记录</li></ul><p>例子：</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 删除年龄为23的第一条记录</span>
db.table.deleteOne<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'age'</span>:23<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 删除所有年龄为23的数据</span>
db.table.deleteMany<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'age'</span>:23<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="查询文档"><a href="#查询文档" aria-hidden="true" class="header-anchor">#</a> 查询文档</h3><h4 id="普通查询"><a href="#普通查询" aria-hidden="true" class="header-anchor">#</a> 普通查询</h4><p>使用<code>db.table.find()</code>进行文档查询：</p><div class="language-bash extra-class"><pre class="language-bash"><code>db.table.find<span class="token punctuation">(</span>
  condition,
  projection
<span class="token punctuation">)</span>
</code></pre></div><p>参数说明：</p><ul><li><strong>condition</strong>: 查询条件</li><li><strong>projection</strong>: 返回指定的键值。查询时如果返回所有键值，省略该参数即可。</li></ul><div class="warning custom-block"><p class="custom-block-title">注意</p><p><code>projection</code>指定有两种模式，且这两种模式不可<strong>混用</strong>，如果混用，系统无法推断其他键值是否返回。</p><p><code>db.table.find(condition,{name:1,age:1})</code> # includsion 模式，指定返回的键，不返回其他键</p><p><code>db.table.find(condition,{name:0,age:0})</code> # exclusion 模式，指定不返回的键，其他键返回。</p><p><code>db.table.find(condition,{name:0,age:1})</code> # 错误使用</p></div><div class="warning custom-block"><p class="custom-block-title">特殊情况</p><p>_id 只有在<code>includsion</code>模式下可以指定是否显示</p><p><code>db.table.find(condition,{_id:0,name:1})</code> # id 不显</p><p><code>db.table.find(condition,{_id:1,name:0})</code> # 报错</p></div><h4 id="条件查询"><a href="#条件查询" aria-hidden="true" class="header-anchor">#</a> 条件查询</h4><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 查找年龄小于等于25岁的数据</span>
db.table.find<span class="token punctuation">(</span><span class="token punctuation">{</span>age:<span class="token punctuation">{</span><span class="token variable">$lte</span>:25<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 查找年龄大于16岁的数据</span>
db.table.find<span class="token punctuation">(</span><span class="token punctuation">{</span>age:<span class="token punctuation">{</span><span class="token variable">$gt</span>:16<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 查找年龄大于16岁且名字叫做张三的人</span>
db.table.find<span class="token punctuation">(</span><span class="token punctuation">{</span>age:<span class="token punctuation">{</span><span class="token variable">$gt</span>:16<span class="token punctuation">}</span>,name:<span class="token string">'张三'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 查找名字叫做张三或者年龄大于16岁的人</span>
db.table.find<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token variable">$or</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span>name:<span class="token string">'张三'</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span>age:<span class="token punctuation">{</span><span class="token variable">$gt</span>:16<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 查找年龄大于16且名字叫张三或者李四的人</span>
db.table.find<span class="token punctuation">(</span><span class="token punctuation">{</span>age:<span class="token punctuation">{</span><span class="token variable">$gt</span>:16<span class="token punctuation">}</span>,<span class="token variable">$or</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span>name:<span class="token string">'张三'</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span>name:<span class="token string">'李四'</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 模糊查询，查询名字中带有张字的人</span>
db.table.find<span class="token punctuation">(</span><span class="token punctuation">{</span>name:/张/<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 查询名字中以张开头的人</span>
db.table.find<span class="token punctuation">(</span><span class="token punctuation">{</span>name:/^张/<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 查询名字中以张结尾的人</span>
db.table.find<span class="token punctuation">(</span><span class="token punctuation">{</span>name:/张$/<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">操作符速记小技巧</p><p><code>$gt</code>: greater then <code>&gt;</code></p><p><code>$gte</code>: gt equal <code>&gt;=</code></p><p><code>$lt</code>: less then <code>&lt;</code></p><p><code>$lte</code>: lt equal <code>&lt;=</code></p><p><code>$ne</code>: not equal <code>!=</code></p><p><code>eq</code>: equal <code>=</code></p></div><h4 id="限制长度"><a href="#限制长度" aria-hidden="true" class="header-anchor">#</a> 限制长度</h4><p>查询文档指定条数，比如分页查询时使用：</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 查询年龄大于16岁的 前10条数据</span>
db.table.find<span class="token punctuation">(</span><span class="token punctuation">{</span>age:<span class="token punctuation">{</span><span class="token variable">$gt</span>:16<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>.limit<span class="token punctuation">(</span>10<span class="token punctuation">)</span>
</code></pre></div><h4 id="跳过查询"><a href="#跳过查询" aria-hidden="true" class="header-anchor">#</a> 跳过查询</h4><p>查询时跳过指定条数的数据进行查询：</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 查询年龄大于16岁的 第11-20条数据</span>
db.table.find<span class="token punctuation">(</span><span class="token punctuation">{</span>age:<span class="token punctuation">{</span><span class="token variable">$gt</span>:16<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>.limit<span class="token punctuation">(</span>10<span class="token punctuation">)</span>.skip<span class="token punctuation">(</span>10<span class="token punctuation">)</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">提示</p><p>结合<code>limit</code>和<code>skip</code>可做分页查询</p></div><h3 id="排序"><a href="#排序" aria-hidden="true" class="header-anchor">#</a> 排序</h3><p>排序是难免的，经常有数据按某个字段升序或者降序排列，使用<code>db.table.find().sort()</code>可进行排序操作：</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 检索数据并按年龄的升序顺序进行排列</span>
db.table.find<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span>_id:0<span class="token punctuation">}</span><span class="token punctuation">)</span>.sort<span class="token punctuation">(</span><span class="token punctuation">{</span>age:1<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">提示</p><p><code>sort</code>中，指定排序<code>key</code>为<code>1</code>或者<code>-1</code>来进行排序，其中<code>1</code>为升序，<code>-1</code>为降序</p></div><div class="warning custom-block"><p class="custom-block-title">警告</p><p>当<code>limit</code>、<code>skip</code>、<code>sort</code>三个一起执行的时候，<code>db.table.find().limit().skip().sort()</code>，先执行<code>sort</code>，再执行<code>skip</code>，最后才是<code>limit</code></p></div><h3 id="索引"><a href="#索引" aria-hidden="true" class="header-anchor">#</a> 索引</h3><p>适当的加入给数据表加入索引可以大大提高查询效率，尤其在有大数据的情况下，效果是显著的。</p><p>建立索引使用<code>db.table.createIndex(key, options)</code>，和<code>sort</code>一样，<code>key</code>可以指定<code>1</code>和<code>-1</code>进行升序降序的排列。</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 单字段索引</span>
db.table.createIndex<span class="token punctuation">(</span><span class="token punctuation">{</span>name:1<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 多字段索引</span>
db.table.createIndex<span class="token punctuation">(</span><span class="token punctuation">{</span>name:1,age:-1<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>其中<code>options</code>的可选值有：</p><table><thead><tr><th>属性</th><th>类型</th><th>介绍</th></tr></thead><tbody><tr><td><strong>background</strong></td><td>Boolean</td><td>建索引过程会阻塞其它数据库操作，background 可指定以后台方式创建索引，即增加 &quot;background&quot; 可选参数。 &quot;background&quot; 默认值为 false</td></tr><tr><td><strong>unique</strong></td><td>Boolean</td><td>建立的索引是否唯一。指定为 true 创建唯一索引。默认值为 false</td></tr><tr><td><strong>name</strong></td><td>String</td><td>索引的名称。如果未指定，MongoDB 的通过连接索引的字段名和排序顺序生成一个索引名称</td></tr><tr><td><strong>sparse</strong></td><td>Boolean</td><td>对文档中不存在的字段数据不启用索引；这个参数需要特别注意，如果设置为 true 的话，在索引字段中不会查询出不包含对应字段的文档。默认值为 false</td></tr><tr><td><strong>expireAfterSeconds</strong></td><td>Int</td><td>指定一个以秒为单位的数值，完成 TTL 设定，设定集合的生存时间</td></tr><tr><td><strong>weights</strong></td><td>Document</td><td>索引权重值，数值在 1 到 99,999 之间，表示该索引相对于其他索引字段的得分权重</td></tr><tr><td><strong>default_language</strong></td><td>String</td><td>对于文本索引，该参数决定了停用词及词干和词器的规则的列表。 默认为英语</td></tr><tr><td><strong>language_override</strong></td><td>String</td><td>对于文本索引，该参数指定了包含在文档中的字段名，语言覆盖默认的 language，默认值为 language</td></tr></tbody></table><h3 id="聚合"><a href="#聚合" aria-hidden="true" class="header-anchor">#</a> 聚合</h3><p><strong>聚合</strong>主要用于处理数据，比如求平均值，求和等，并返回数据结果。</p><p>在<code>mongodb</code>中使用<code>aggregate()</code>方法完成聚合。</p><p>用例子说话，先定义如下数据：</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    _id: ObjectId<span class="token punctuation">(</span>7df78ad8902c<span class="token punctuation">)</span>,
    bookName: <span class="token string">'JavaScript高级程序指南'</span>,
    owner: <span class="token string">'张三'</span>,
    like: 50
  <span class="token punctuation">}</span>,
  <span class="token punctuation">{</span>
    _id: ObjectId<span class="token punctuation">(</span>7df78ad8902d<span class="token punctuation">)</span>,
    bookName: <span class="token string">'你不知道的JavaScript'</span>,
    owner: <span class="token string">'李四'</span>,
    like: 60
  <span class="token punctuation">}</span>,
  <span class="token punctuation">{</span>
    _id: ObjectId<span class="token punctuation">(</span>7df78ad8902e<span class="token punctuation">)</span>,
    bookName: <span class="token string">'深入浅出Node.js'</span>,
    owner: <span class="token string">'张三'</span>,
    like: 70
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>然后我们使用<code>aggregate</code>对上面的数据做个分组，并且统计每个人拥有的书籍数量：</p><div class="language-bash extra-class"><pre class="language-bash"><code>db.table.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token variable">$group</span><span class="token keyword">:</span> <span class="token punctuation">{</span>_id: <span class="token string">'<span class="token variable">$owner</span>'</span>, bookNumber: <span class="token punctuation">{</span><span class="token variable">$sum</span><span class="token keyword">:</span> 1<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 得到结果如下</span>
<span class="token punctuation">{</span><span class="token string">&quot;_id&quot;</span><span class="token keyword">:</span> <span class="token string">&quot;李四&quot;</span>,<span class="token string">&quot;BookNumber: 1&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;_id&quot;</span><span class="token keyword">:</span> <span class="token string">&quot;张三&quot;</span>,<span class="token string">&quot;BookNumber: 2&quot;</span><span class="token punctuation">}</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">警告</p><p><code>_id</code>目前发现不可自定义，否则会报 <code>the field 'xxx' must be an accumulator object</code>的错误</p><p>还有跟在<code>_id</code>后的 <code>$owner</code>的<code>$</code>号不能少，不然查询出来的结果将会错误。</p></div><p>可聚合的表达式有：</p><ul><li><code>$sum</code>: 计算总和</li><li><code>$avg</code>: 计算平均值</li><li><code>$min</code>: 获取集合中所有文档对应值的最小值</li><li><code>$max</code>: 获取集合中所有文档对应值的最大值</li><li><code>$push</code>: 将结果文档中插入值到一个数组中</li><li><code>$addToSet</code>: 在结果文档中插入值到一个数组中，但不创建副本</li><li><code>$first</code>: 根据资源文档的排序获取第一个文档数据</li><li><code>$last</code>: 根据资源文档的排序获取最后一个文档数据</li></ul><p>类似于<code>$group</code>的管道操作还有：</p><ul><li><code>$project</code>: 修改输入文档的结构。可以用来重命名，增加或者删除域，也可以用于创建计算结果。</li><li><code>$match</code>: 用于过滤数据，只输出符合要求的文档</li><li><code>$limit</code>: 限制返回的文档数</li><li><code>$skip</code>:  跳过指定数量的文档数，并返回余下的文档</li><li><code>$unwind</code>: 将文档中的某一个数组类型字段拆分成多条，每条包含数组中的一个值</li><li><code>$group</code>: 分组文档，常用于统计</li><li><code>$sort</code>: 将文档排序后输出</li><li><code>$geoNear</code>: 输出接近某一地理位置的有序文档</li></ul><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 获取50&lt;喜欢人数&lt;=60的书籍数量，并统计</span>
db.table.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span><span class="token variable">$match</span><span class="token keyword">:</span> <span class="token punctuation">{</span>like: <span class="token punctuation">{</span><span class="token variable">$gt</span><span class="token keyword">:</span> 50, <span class="token variable">$lte</span><span class="token keyword">:</span> 60<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>,
  <span class="token punctuation">{</span><span class="token variable">$group</span><span class="token keyword">:</span> <span class="token punctuation">{</span>_id: null, count: <span class="token punctuation">{</span><span class="token variable">$sum</span><span class="token keyword">:</span> 1<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div></div><div class="page-edit"><!----><div class="last-updated"><span class="prefix">上次更新: </span><span class="time">9/4/2018, 4:31:54 PM</span></div></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/flutter/dart.html" class="prev">
          Dart基础语法
        </a></span><span class="next"><a href="/services/mongodb.html">
          正经学个mongoDB吧！
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/14.451eca1f.js" defer></script><script src="/assets/js/app.a03d4e4f.js" defer></script>
  </body>
</html>
