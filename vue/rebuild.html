<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>重构Vue阅读器 | Xiao Blog</title>
    <meta name="description" content="">
    <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/31.styles.72922159.css" as="style"><link rel="preload" href="/assets/js/app.a03d4e4f.js" as="script"><link rel="preload" href="/assets/js/6.d6543f82.js" as="script"><link rel="prefetch" href="/assets/js/0.0f59b883.js"><link rel="prefetch" href="/assets/js/1.9796cf5f.js"><link rel="prefetch" href="/assets/js/2.2a946d02.js"><link rel="prefetch" href="/assets/js/3.59a83de8.js"><link rel="prefetch" href="/assets/js/4.21fdbdec.js"><link rel="prefetch" href="/assets/js/5.a09ec324.js"><link rel="prefetch" href="/assets/js/7.3de0ccee.js"><link rel="prefetch" href="/assets/js/8.88711e9b.js"><link rel="prefetch" href="/assets/js/9.338fb1f3.js"><link rel="prefetch" href="/assets/js/10.538a23d4.js"><link rel="prefetch" href="/assets/js/11.55badfb5.js"><link rel="prefetch" href="/assets/js/12.6f950838.js"><link rel="prefetch" href="/assets/js/13.5399a19b.js"><link rel="prefetch" href="/assets/js/14.451eca1f.js"><link rel="prefetch" href="/assets/js/15.35ff6acf.js"><link rel="prefetch" href="/assets/js/16.ece38f4c.js"><link rel="prefetch" href="/assets/js/17.3bcb6de9.js"><link rel="prefetch" href="/assets/js/18.74c09d5d.js"><link rel="prefetch" href="/assets/js/19.aa302882.js"><link rel="prefetch" href="/assets/js/20.d26e17c2.js"><link rel="prefetch" href="/assets/js/21.140f1446.js"><link rel="prefetch" href="/assets/js/22.d56b6200.js"><link rel="prefetch" href="/assets/js/23.c0b205ad.js"><link rel="prefetch" href="/assets/js/24.e3ca6758.js"><link rel="prefetch" href="/assets/js/25.5bbdea6c.js"><link rel="prefetch" href="/assets/js/26.15fba687.js"><link rel="prefetch" href="/assets/js/27.36d4982c.js"><link rel="prefetch" href="/assets/js/28.ef10919f.js"><link rel="prefetch" href="/assets/js/29.1fd2d94f.js"><link rel="prefetch" href="/assets/js/30.152778aa.js">
    <link rel="stylesheet" href="/assets/css/31.styles.72922159.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Xiao Blog
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><!----></div></header><div class="sidebar-mask"></div><div class="sidebar"><!----><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>JavaScript</span><!----></p><ul class="sidebar-group-items"><li><a href="/javascript/" class="sidebar-link">前端缓存</a></li><li><a href="/javascript/partner.html" class="sidebar-link">设计模式</a></li><li><a href="/javascript/canvas.html" class="sidebar-link">canvas踩坑记</a></li><li><a href="/javascript/listview.html" class="sidebar-link">List-view 实现</a></li><li><a href="/javascript/typescript.html" class="sidebar-link">Typescript</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Vue</span><!----></p><ul class="sidebar-group-items"><li><a href="/vue/" class="sidebar-link">Vuex学习笔记</a></li><li><a href="/vue/vuex-persistence.html" class="sidebar-link">Vuex 持久化方案一</a></li><li><a href="/vue/vueMultipage.html" class="sidebar-link">vue多页配置</a></li><li><a href="/vue/optimize.html" class="sidebar-link">vue项目优化</a></li><li><a href="/vue/parcel-vue.html" class="sidebar-link">parcel-vue初体验</a></li><li><a href="/vue/sync-component.html" class="sidebar-link">异步组件</a></li><li><a href="/vue/rebuild.html" class="active sidebar-link">重构Vue阅读器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue/rebuild.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/vue/rebuild.html#配置" class="sidebar-link">配置</a></li><li class="sidebar-sub-header"><a href="/vue/rebuild.html#重构-阅读器" class="sidebar-link">重构 -- 阅读器</a></li><li class="sidebar-sub-header"><a href="/vue/rebuild.html#bugs" class="sidebar-link">bugs</a></li></ul></li><li><a href="/vue/vue-tsx.html" class="sidebar-link">搭建vue-tsx风格的开发模板</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>WebApp</span><!----></p><ul class="sidebar-group-items"><li><a href="/webapp/" class="sidebar-link">cordova 打包</a></li><li><a href="/webapp/questions.html" class="sidebar-link">移动端问题锦集</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Flutter</span><!----></p><ul class="sidebar-group-items"><li><a href="/flutter/" class="sidebar-link">环境搭建</a></li><li><a href="/flutter/dart.html" class="sidebar-link">Dart基础语法</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Services</span><!----></p><ul class="sidebar-group-items"><li><a href="/services/" class="sidebar-link">Mongodb 好像有点意思？</a></li><li><a href="/services/mongodb.html" class="sidebar-link">正经学个mongoDB吧！</a></li><li><a href="/services/python.html" class="sidebar-link">学学Python吧~</a></li><li><a href="/services/mysql.html" class="sidebar-link">向mysql低头</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>其他</span><!----></p><ul class="sidebar-group-items"><li><a href="/others/" class="sidebar-link">VSCode 常用插件推荐</a></li><li><a href="/others/vsESlint.html" class="sidebar-link">VSCode ESLint 配置</a></li><li><a href="/others/nginx.html" class="sidebar-link">nginx服务器搭建</a></li><li><a href="/others/android-dev.html" class="sidebar-link">Mac 配置 Android 环境</a></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="重构-vue-阅读器"><a href="#重构-vue-阅读器" aria-hidden="true" class="header-anchor">#</a> 重构 Vue 阅读器</h1><p>早期项目因为赶进度之类的，一些代码和模块都是挤在一起，显得很冗余，也很不方便之后的维护，所以打算将公司的项目进行一次重构，本次重构使用<code>vue-cli3.0</code>为模板进行升级重构。</p><h2 id="安装"><a href="#安装" aria-hidden="true" class="header-anchor">#</a> 安装</h2><p>直接使用命令安装新版本的<code>vue-cli</code>：</p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> -g @vue/cli
<span class="token comment"># 或者</span>
yarn global add @vue/cli
</code></pre></div><p>安装成功后，直接通过<code>vue create project</code>来创建项目即可。</p><div class="tip custom-block"><p class="custom-block-title">提示</p><p>有趣的是，<code>vue-cli3.0</code>提供了一个<strong>可视化</strong>的操作面板，可以通过这个面板创建、打包、分析以及管理项目，也可以进行包的管理。感兴趣的朋友可以直接通过命令<code>vue ui</code>玩耍玩耍~</p></div><h2 id="配置"><a href="#配置" aria-hidden="true" class="header-anchor">#</a> 配置</h2><p>不同于<code>vue-cli</code>之前版本的是，<code>vue-cli3.0</code>缩小的大幅度的配置，因为内部已经配置了大多数常用的<code>webpack</code>配置了，而我们只需要在根目录配置一个<code>vue.config.js</code>文件就可以管理以及配置我们的项目。</p><p>这里我们也不细说怎么去配置<code>vue.config.js</code>，<a href="https://cli.vuejs.org/zh/config/" target="_blank" rel="noopener noreferrer">官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>其实说的也很清楚了，这里就直接上一些简单的配置：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js 配置</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  baseUrl<span class="token punctuation">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span>
  lintOnSave<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  indexPath<span class="token punctuation">:</span> <span class="token string">&quot;index.html&quot;</span><span class="token punctuation">,</span>
  chainWebpack<span class="token punctuation">:</span> config <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 修改webpack内部配置</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 修改打包模板</span>
      config<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">&quot;html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>args <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>template <span class="token operator">=</span> <span class="token string">&quot;public/index.prod.html&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 加上属性引号</span>
        args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>minify<span class="token punctuation">.</span>removeAttributeQuotes <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> args<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 忽略文件设置</span>
      config<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">&quot;copy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>args <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ignore <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ignore<span class="token punctuation">,</span> <span class="token string">&quot;index.prod.html&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> args<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  configureWebpack<span class="token punctuation">:</span> config <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 增加webpack配置</span>
    <span class="token comment">// 打包忽略项</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      config<span class="token punctuation">.</span>externals <span class="token operator">=</span> <span class="token punctuation">{</span>
        vue<span class="token punctuation">:</span> <span class="token string">&quot;Vue&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;vue-router&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;VueRouter&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="重构-阅读器"><a href="#重构-阅读器" aria-hidden="true" class="header-anchor">#</a> 重构 -- 阅读器</h2><p>整个项目逻辑最复杂的就是阅读器这块，而阅读器这块，这里打算使用<a href="https://github.com/ustbhuangyi" target="_blank" rel="noopener noreferrer">黄轶老师<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>出品的<a href="https://github.com/ustbhuangyi/better-scroll" target="_blank" rel="noopener noreferrer"><code>better-scroll</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>进行封装重构。</p><p>之所以使用<code>better-scroll</code>我也想了挺久的，<code>better-scroll</code>在滚动上体验上确实没得说，相当的好，唯一让我犹豫的就是它太大了，打包进<code>vendor</code>的话无疑会大大加大包的体积，但是后来又灵光一闪，诶，我打包的时候抽离出来用 cdn 的方式引入不就好了？毕竟<code>gzip</code>只有<code>9kb</code>，就小多了。于是就美滋滋的决定了~。</p><p>扯多了，开始吧~</p><p>阅读器的核心功能，也就是比较难的一个就是<strong>阅读模式</strong>的切换，分<strong>竖屏阅读</strong>和<strong>横屏滚动</strong>阅读。</p><p><strong>竖屏阅读</strong>倒是简单，通过封装<code>better-scroll</code>，默认竖屏滚动即可。</p><p>先简单封装下阅读器的滚动组件<code>reader-wrapper.vue</code>：</p><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>reader-wrapper<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wrapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>[
      <span class="token punctuation">'</span>wrapper-content<span class="token punctuation">'</span>,
      direction === <span class="token punctuation">'</span>horizontal<span class="token punctuation">'</span> ? <span class="token punctuation">'</span>horizontal<span class="token punctuation">'</span> : <span class="token punctuation">'</span>vertical<span class="token punctuation">'</span>]<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>readerWrapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>scroll-content<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span>
             <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>chapter<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">import</span> BScroll <span class="token keyword">from</span> <span class="token string">&quot;better-scroll&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// * 滚动方向</span>
<span class="token keyword">const</span> <span class="token constant">DIRECTION_V</span> <span class="token operator">=</span> <span class="token string">&quot;vertical&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">DIRECTION_H</span> <span class="token operator">=</span> <span class="token string">&quot;horizontal&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">&quot;x-reader-wrapper&quot;</span><span class="token punctuation">,</span>
  props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    probeType<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    click<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Boolean<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    listenScroll<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Boolean<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    direction<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token constant">DIRECTION_V</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    startY<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    bounce<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// * 初始化bs</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">destroyed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>wrapper <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>wrapper<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>wrapper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// * bs 配置</span>
      <span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
        probeType<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>probeType<span class="token punctuation">,</span>
        click<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>click<span class="token punctuation">,</span>
        scrollY<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>direction <span class="token operator">===</span> <span class="token constant">DIRECTION_V</span><span class="token punctuation">,</span>
        scrollX<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>direction <span class="token operator">===</span> <span class="token constant">DIRECTION_H</span><span class="token punctuation">,</span>
        startY<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>startY<span class="token punctuation">,</span>
        bounce<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bounce<span class="token punctuation">,</span>
        momentum<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>direction <span class="token operator">===</span> <span class="token constant">DIRECTION_V</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span>scroll <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BScroll</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>wrapper<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>listenScroll<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// * 监听滚动</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scroll<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;scroll&quot;</span><span class="token punctuation">,</span> pos <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;scroll&quot;</span><span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>scroll <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scroll<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>scroll <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scroll<span class="token punctuation">.</span>scrollTo<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>scroll<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>scroll<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>然后新建一个<code>reader.vue</code>用来引用<code>reader-wrapper.vue</code>：</p><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>reader<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>reader-wrapper</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>reader<span class="token punctuation">&quot;</span></span>
                    <span class="token attr-name">:direction</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>direction<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>x-reader-text-name<span class="token punctuation">&quot;</span></span><span class="token style-attr language-css"><span class="token attr-name">
         <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">font-size</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>第1章 初相见<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>x-reader-text-paragraph<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>哈哈十二年的冬月初1，是顾轻舟的生日，她今天十六岁整了。<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!-- 省略若干 --&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>x-reader-text-paragraph<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> “叫！”他命令道，声音嘶哑。<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>reader-wrapper</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">import</span> ReaderWrapper <span class="token keyword">from</span> <span class="token string">&quot;./reader-wrapper&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  components<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    ReaderWrapper
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      direction<span class="token punctuation">:</span> <span class="token string">&quot;horizontal&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这样竖屏滚动就好了。</p><h3 id="横屏滚动"><a href="#横屏滚动" aria-hidden="true" class="header-anchor">#</a> 横屏滚动</h3><p>横屏滚动要考虑的东西就有些多了：</p><ul><li>页面的布局 类似轮播一样排版，但是又不是轮播</li><li>滚动方向</li><li>滚动边界的判断 下一页还是下一章 上一页还是上一章</li></ul><p>第一点，因为小说内容谁也不知道一页里能放下多少段话，所以对于横屏的分页来说有点小麻烦，不过好在有个<code>css</code>属性能帮助我们解决这个--<code>columm</code>布局。</p><p>我们通过<code>column-width</code>和<code>column-gap</code>两个属性即可，因为<code>column-count</code>我们并不知道可以分成几列。</p><ul><li><code>column-width</code> - 列宽</li><li><code>column-gap</code> - 每列的间隔</li></ul><p>具体可以参照菜鸟教程或者 w3school 去了解。这里都没有书写<code>css</code>的内容~。</p><p>我们改装下之前封装的<code>reader-wrapper.vue</code>，首先我们需要监听<code>direction</code>，如果方向改变了，则需要去计算滚动宽度：</p><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">direction</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initDir</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">initDir</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// * 初始化滚动方向</span>
      <span class="token keyword">let</span> refs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>dir <span class="token operator">===</span> <span class="token string">&quot;horizontal&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// * 横向需要一个总内容宽度</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// * 在 column 布局下，可以直接获取元素的scrollWidth</span>
          refs<span class="token punctuation">.</span>content<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> refs<span class="token punctuation">.</span>chapter<span class="token punctuation">.</span>scrollWidth <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// * 竖向清除内容宽度 默认为设备宽度</span>
        refs<span class="token punctuation">.</span>content<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// * 重置滚动位置</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>总宽度知道的话，我们就能知道一章小说能够被分为多少页，因为设备宽度我们也能获取，可以通过<code>滚动宽度 / 设备宽度 = 页数</code></p><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">countPage</span><span class="token punctuation">(</span>total<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// * 计算总页码数</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>
        window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span>
        window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>offsetWidth
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// * 设置可视距离宽度</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>chapter<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
      <span class="token comment">// * 页码结果向上取整</span>
      <span class="token keyword">let</span> pageCount <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>total <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;count-page&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        pageCount<span class="token punctuation">,</span>
        disArr<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">perSwiperDis</span><span class="token punctuation">(</span>pageCount<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 每页需要的滚动距离</span>
        dWidth<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">perSwiperDis</span><span class="token punctuation">(</span>totalPage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// * 计算每页的滚动距离</span>
      <span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> totalPage<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sum <span class="token operator">+=</span> <span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">;</span>
        arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> arr<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>然后在<code>initDir</code>方法中调用下即可：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ...</span>
refs<span class="token punctuation">.</span>content<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> refs<span class="token punctuation">.</span>chapter<span class="token punctuation">.</span>scrollWidth <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// * 计算页码</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">countPage</span><span class="token punctuation">(</span>refs<span class="token punctuation">.</span>chapter<span class="token punctuation">.</span>scrollWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
</code></pre></div><p>然后就是滚动滑页和方向的判断，一开始我是使用监听滚动事件，然后每次滚动的坐标<code>x</code>去和页面滚动距离数组中循环对比，然后去计算判断方向，后来发现这样太傻逼了，也相当耗性能，每次都得去循环判断，累都得累死。</p><p>后来发现<code>bs</code>有提供一个<code>movingDirectionX</code>的属性，可以知道用户在滑动的过程中是从哪个方向进行滑动的，然后就有一个简便点的方式，一个是，我不需要滚动的实时坐标，我只要用户离开屏幕后的坐标即可，而且我也不需要循环滚动距离数组去做对比，我只要知道我在哪一页就行了，因为<code>页码-1</code>后就对应滚动距离数组中的值。</p><p>可能看着理解起来有些乱，那我们直接就用代码说话吧，找到<code>reader-wrapper.vue</code>：</p><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 省略若干代码...</span>
      <span class="token comment">// * 监听手指离开屏幕的事件 并返回最后的x，y坐标和移动方向</span>
      <span class="token comment">// * 我们只需要横屏滚动的时候监听</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>direction <span class="token operator">===</span> <span class="token constant">DIRECTION_H</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scroll<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;touchEnd&quot;</span><span class="token punctuation">,</span> pos <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;touch&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            pos<span class="token punctuation">,</span>
            dir<span class="token punctuation">:</span> <span class="token punctuation">{</span>
              x<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scroll<span class="token punctuation">.</span>movingDirectionX<span class="token punctuation">,</span>
              y<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scroll<span class="token punctuation">.</span>movingDirectionY
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 省略若干代码...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>然后进入<code>reader.vue</code>页面：</p><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>reader<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 绑定上组件返回的事件 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>reader-wrapper</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>reader<span class="token punctuation">&quot;</span></span>
                    <span class="token attr-name">:direction</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>direction<span class="token punctuation">&quot;</span></span>
                    <span class="token attr-name">@touch</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>touch<span class="token punctuation">&quot;</span></span>
                    <span class="token attr-name">@count-page</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>countPage<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!-- 省略内部结构 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>reader-wrapper</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">import</span> ReaderWrapper <span class="token keyword">from</span> <span class="token string">&quot;./reader-wrapper&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// * 滚动阈值</span>
<span class="token keyword">const</span> <span class="token constant">THRESHOLD_NEXT</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">THRESHOLD_PREV</span> <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  components<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    ReaderWrapper
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      direction<span class="token punctuation">:</span> <span class="token string">&quot;horizontal&quot;</span><span class="token punctuation">,</span>
      pageCount<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      curPage<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      distance<span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">touch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> pos<span class="token punctuation">,</span> dir <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// * 只对横向滚动 边界判断</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>direction <span class="token operator">===</span> <span class="token string">&quot;vertical&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>distance <span class="token operator">=</span> pos<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
      <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>disArr<span class="token punctuation">;</span>
      <span class="token keyword">let</span> pageDir <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>curPage <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> diff <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>distance <span class="token operator">-</span> pageDir<span class="token punctuation">;</span>
      <span class="token comment">// * 从右向左滑</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>dir<span class="token punctuation">.</span>x <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>diff <span class="token operator">&lt;</span> <span class="token constant">THRESHOLD_NEXT</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">nextPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">lockPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// * 从左向右滑</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>dir<span class="token punctuation">.</span>x <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>diff <span class="token operator">&gt;</span> <span class="token constant">THRESHOLD_PREV</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">prevPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">lockPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">countPage</span><span class="token punctuation">(</span><span class="token punctuation">{</span> pageCount<span class="token punctuation">,</span> disArr<span class="token punctuation">,</span> dWidth <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// * pageCount - 总页数</span>
      <span class="token comment">// * disArr - 每页需要的滚动距离</span>
      <span class="token comment">// * dWidth - 设备宽度</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pageCount <span class="token operator">=</span> pageCount<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>disArr <span class="token operator">=</span> disArr<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> dWidth<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">nextPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// * 翻页逻辑 -- 下一页</span>
      <span class="token keyword">let</span> reader <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>reader<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>curPage <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// * 最后一页再往后翻 就获取下一章内容</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;最后一页了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>curPage<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">lockPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">prevPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// * 翻页逻辑 -- 上一页</span>
      <span class="token keyword">let</span> reader <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>reader<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>curPage <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// * 第一页再往前翻 就获取上一章内容</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;第一页了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>curPage<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">lockPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">lockPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// * 锁定停留的页面</span>
      <span class="token keyword">let</span> reader <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>reader<span class="token punctuation">;</span>
      <span class="token keyword">let</span> pageDir <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>disArr<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>curPage <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      reader<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span>pageDir<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>distance <span class="token operator">=</span> pageDir<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这样一个阅读器大致的功能就出来了。不过后来测试也发现了一些问题：</p><ul><li>切换横竖屏的时候，横屏滚动会出现不流畅的情况</li><li>使用<code>padding</code>等让盒子宽度变化的属性时，会加入到滚动距离中，导致滚动到最后一页时，出现偏差</li></ul><p>第一个问题，解决方案是，在切换横竖屏后，销毁<code>bs</code>实例，然后重新初始化一个新的实例。</p><p>第二个问题就是避免在容器上加例如<code>padding</code>的属性，从内部段落上加入<code>padding</code>等属性即可。</p><p>最后实现的效果如下：</p><img src="/assets/reader/reader.gif"><hr><h3 id="显示阅读器的菜单"><a href="#显示阅读器的菜单" aria-hidden="true" class="header-anchor">#</a> 显示阅读器的菜单</h3><p>阅读器的核心部分完成之后，接下来就是显示阅读的操作菜单了。</p><p>我们先在<code>reader-wrapper.vue</code>中布置出菜单部分：</p><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>reader-wrapper<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wrapper<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name">:</span><span class="token style-attr language-css"><span class="token attr-name"><span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token punctuation">{</span><span class="token property">fontSize</span><span class="token punctuation">:</span>fz<span class="token punctuation">}</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 阅读器部分 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>[
      <span class="token punctuation">'</span>wrapper-content<span class="token punctuation">'</span>,
      direction === <span class="token punctuation">'</span>horizontal<span class="token punctuation">'</span> ? <span class="token punctuation">'</span>horizontal<span class="token punctuation">'</span> : <span class="token punctuation">'</span>vertical<span class="token punctuation">'</span>]<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>readerWrapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>scroll-content<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span>
             <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>chapter<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 头部菜单和底部菜单 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>down<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wrapper-header<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>menu<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>reader-header</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>reader-header</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>up<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wrapper-menu<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>menu<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>menu<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>reader-menu</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>reader-menu</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>之所以菜单部分还是用插槽是因为，之后是有打算将阅读器部分完全抽离出来，封装成独立的组件，方便之后的项目使用，不同的项目，可能菜单部分多少有些不一样，所以使用插槽，让其更具灵活一些。</p><p>这里还加入了显示菜单的动画，用过阅读 app 的朋友都能看到这么个效果，呼出操作菜单的时候，顶部是下滑而出，底部是上滑而出，所以我们要做的也是这个效果，直接使用<code>transition</code>即可，动画效果也比较简单：</p><div class="language-stylus extra-class"><pre class="language-stylus"><code><span class="token comment">// 下滑</span>
<span class="token selector">.down-enter<span class="token punctuation">,</span> .down-leave-to <span class="token punctuation">{</span></span>
  <span class="token property-declaration"><span class="token property">opacity</span> <span class="token number">0</span></span>
  <span class="token property-declaration"><span class="token property">transform</span> <span class="token func"><span class="token function">translateY</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">100%</span><span class="token punctuation">)</span></span></span>
<span class="token punctuation">}</span>

<span class="token comment">// 上滑</span>
<span class="token selector">.up-enter<span class="token punctuation">,</span> .up-leave-to <span class="token punctuation">{</span></span>
  <span class="token property-declaration"><span class="token property">opacity</span> <span class="token number">0</span></span>
  <span class="token property-declaration"><span class="token property">transform</span> <span class="token func"><span class="token function">translateY</span><span class="token punctuation">(</span><span class="token number">100%</span><span class="token punctuation">)</span></span></span>
<span class="token punctuation">}</span>

<span class="token selector">.down-enter-active<span class="token punctuation">,</span> .down-leave-active<span class="token punctuation">,</span>
.up-enter-active<span class="token punctuation">,</span> .up-leave-active <span class="token punctuation">{</span></span>
  <span class="token property-declaration"><span class="token property">transition</span> all <span class="token number">0.3</span>s</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后我们建立一个<code>reader-header.vue</code>和<code>reader-menu.vue</code>用于放置头部菜单和底部菜单，<code>reader-header</code>部分比较简单：</p><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token comment">&lt;!-- reader-header.vue --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>reader-header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    header
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>然后就是<code>reader-menu</code>部分：</p><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>reader-menu<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>reader-menu__box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>menu-box__text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>字号<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>menu-box__item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item-font__operator item-font__subtract<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>A-<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item-font__text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>19<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item-font__operator item-font__add<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>A+<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item-font__reset<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>默认<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>reader-menu__box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>menu-box__text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>背景<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>menu-box__item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item-bg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item-bg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item-bg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item-bg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item-bg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>reader-menu__box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>menu-box__item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item-operator<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>上一章<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item-operator<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>目录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item-operator<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>翻页方式<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item-operator<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>夜间<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item-operator<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>下一章<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这样，头部和底部的菜单就完成了。</p><p>哈哈哈 都是简单的书写哈~</p><p>最后完成的效果如下：</p><img src="/assets/reader/reader-menu.gif"><hr><h3 id="字体大小切换"><a href="#字体大小切换" aria-hidden="true" class="header-anchor">#</a> 字体大小切换</h3><p>唔，昨天我们把底部菜单的布局给实现了，今天实现下一些具体功能 -- <strong>字体大小切换</strong></p><p>阅读器上肯定会存在一些默认属性，比如默认的字体大小，默认的背景色，默认的阅读方式(竖屏还是横屏)之类的，我们可以将这些默认配置写入到一个配置文件里，这里有两种方式做默认配置：</p><ul><li>一个通过<code>vuex</code>来控制这些默认数据</li><li>一个是通过一个<code>js</code>文件存储，然后通过<code>bus</code>来操作</li></ul><p>两者不管使用哪一种，都得需要借助<code>localStorage</code>来保存用户的操作，避免刷新浏览器后重置了用户的设置。</p><p>我个人喜欢将用户容易操作到的变量存入<code>vuex</code>中，然后一些固有数据放在<code>js</code>配置文件中做使用，这里就不做<code>vuex</code>的配置和说明了，看<a href="https://vuex.vuejs.org/zh/guide/" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>或者我之前写过的一篇粗略的<a href="/vue/index.html">Vuex 学习笔记</a>也可。</p><p>我这里将用户的常用操作变量放在<code>vuex中</code>：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// state.js</span>
<span class="token keyword">const</span> str <span class="token operator">=</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">;</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  fontSize<span class="token punctuation">:</span> str<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;fontSize&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token comment">// 默认字体</span>
  bgIndex<span class="token punctuation">:</span> str<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;bgIndex&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 背景索引</span>
  direction<span class="token punctuation">:</span> str<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;direction&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;vertical&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 阅读方式</span>
  night<span class="token punctuation">:</span> str<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;night&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token boolean">false</span> <span class="token comment">// 是否夜间模式</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> state<span class="token punctuation">;</span>
</code></pre></div><p>都是优先从缓存中取，如果有就用缓存数据，没有则使用默认数据。</p><p><code>commit</code>部分就不写了，这里就写下<code>action</code>部分，用户操作<code>commit</code>后顺便将这些数据存入缓存中：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// action.js</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> type <span class="token keyword">from</span> <span class="token string">&quot;./mutation-type&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> str <span class="token operator">=</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">;</span>

<span class="token comment">// 修改阅读器的设置</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">setReaderOptions</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> commit<span class="token punctuation">,</span> getters <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> value <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&quot;font&quot;</span><span class="token punctuation">:</span>
      <span class="token function">commit</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token constant">SET_FONTSIZE</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      str<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;fontSize&quot;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;bg&quot;</span><span class="token punctuation">:</span>
      <span class="token function">commit</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token constant">SET_BG_INDEX</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      str<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;bgIndex&quot;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;direction&quot;</span><span class="token punctuation">:</span>
      <span class="token function">commit</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token constant">SET_READER_DIRECTION</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      str<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;direction&quot;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;night&quot;</span><span class="token punctuation">:</span>
      <span class="token function">commit</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token constant">TOGGLE_READER_NIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      str<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;night&quot;</span><span class="token punctuation">,</span> getters<span class="token punctuation">.</span>night<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>然后我们再定义一个<code>readerOptions.js</code>来放置固定的配置数据：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// readerOptions.js</span>
<span class="token keyword">const</span> readerOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  defaultFontSize<span class="token punctuation">:</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token comment">// 默认字体大小</span>
  maxFontSize<span class="token punctuation">:</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token comment">// 最大字体大小</span>
  minFontSize<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token comment">// 最小字体大小</span>
  bgColorList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 背景列表，含背景色，对应背景色的字体色，暂时没找对应数据</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> readerOptions<span class="token punctuation">;</span>
</code></pre></div><p>最后我们就在<code>reader-menu.vue</code>中引入使用就行：</p><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> mapState<span class="token punctuation">,</span> mapGetters<span class="token punctuation">,</span> mapActions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vuex&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReaderOptions <span class="token keyword">from</span> <span class="token string">&quot;./readerOptions.js&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token string">&quot;reader&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;direction&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token string">&quot;reader&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;fontSize&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;night&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      min<span class="token punctuation">:</span> ReaderOptions<span class="token punctuation">.</span>minFontSize<span class="token punctuation">,</span>
      max<span class="token punctuation">:</span> ReaderOptions<span class="token punctuation">.</span>maxFontSize<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> ReaderOptions<span class="token punctuation">.</span>defaultFontSize<span class="token punctuation">,</span>
      bgList<span class="token punctuation">:</span> ReaderOptions<span class="token punctuation">.</span>bgColorList
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">subtract</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fontSize<span class="token punctuation">;</span>
      <span class="token comment">// * 边界判断</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>font <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>min<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setReaderOptions</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&quot;font&quot;</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>font <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;font&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>font <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fontSize<span class="token punctuation">;</span>
      <span class="token comment">// * 边界判断</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>font <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>max<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setReaderOptions</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&quot;font&quot;</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>font <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;font&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>font <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">resetFont</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setReaderOptions</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&quot;font&quot;</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">default</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;font&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">toggleNight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setReaderOptions</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&quot;night&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">changeDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> dir <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>direction <span class="token operator">===</span> <span class="token string">&quot;vertical&quot;</span> <span class="token operator">?</span> <span class="token string">&quot;horizontal&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;vertical&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setReaderOptions</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token string">&quot;direction&quot;</span><span class="token punctuation">,</span>
        value<span class="token punctuation">:</span> dir
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;direction&quot;</span><span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token string">&quot;reader&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;setReaderOptions&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>是不是不难？以为就这样结束了？哎，坑还有着呢~</p><ul><li>修改字体大小后，需要重新刷新<code>bs</code>的容器高度或者宽度，不然会出现滚动不到底的情况</li><li>横屏下，因为字体变化，所以生成的页码数量也会跟着变动，所以需要重新计算页码</li><li>横屏下，如果滑动到第 3 页，再修改字体，页面会默认滚动到最开始的地方，也就是<code>x=0</code>，再次滑动会直接跳过第 2 页，直接到第 3 页，体验不好</li><li>横屏下，重新计算宽度后，滚动不到最后</li></ul><p>想必你们也想到了怎么解决了，对，就是利用<code>bs</code>的<code>refresh</code>方法：</p><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// * 字体变化后需要重新计算宽度</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>direction <span class="token operator">===</span> <span class="token string">&quot;horizontal&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// * 因为重新计算位置后，dom也发生了变化，所以refresh要放在initDir之后</span>
          <span class="token comment">// * 可以使用setTimeout也可以再使用一次this.$nextTick()方法</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initDir</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>direction<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// * 重新锁定滚动位置，原来在第几页就还是第几页</span>
            <span class="token comment">// * false 表示不需要滚动动画，不然修改字体总会从第1页动画滑动到当前页，看起来也不好</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_lockPage</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>老规矩 最后的实现效果如下：</p><img src="/assets/reader/reader-change-font.gif"><hr><h3 id="背景色切换"><a href="#背景色切换" aria-hidden="true" class="header-anchor">#</a> 背景色切换</h3><p>背景色切换相对来说会简单一些，就是根据选择的背景色，去修改容器的<code>background</code>就 OK 了，我们将背景色的数据放入配置文件<code>ReaderOptions.js</code>中：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ReaderOptions.js</span>

<span class="token keyword">const</span> ReaderOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// * 背景集合</span>
  bgColorStyles<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      menuColor<span class="token punctuation">:</span> <span class="token string">&quot;#f5dce4&quot;</span><span class="token punctuation">,</span>
      background<span class="token punctuation">:</span> <span class="token string">&quot;#f5dce4&quot;</span><span class="token punctuation">,</span>
      color<span class="token punctuation">:</span> <span class="token string">&quot;#7B3149&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      menuColor<span class="token punctuation">:</span> <span class="token string">&quot;#DFF5DC&quot;</span><span class="token punctuation">,</span>
      background<span class="token punctuation">:</span> <span class="token string">&quot;#DFF5DC&quot;</span><span class="token punctuation">,</span>
      color<span class="token punctuation">:</span> <span class="token string">&quot;#1F4D2B&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      menuColor<span class="token punctuation">:</span> <span class="token string">&quot;#38658C&quot;</span><span class="token punctuation">,</span>
      background<span class="token punctuation">:</span> <span class="token string">&quot;#38658C&quot;</span><span class="token punctuation">,</span>
      color<span class="token punctuation">:</span> <span class="token string">&quot;#fff&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      menuColor<span class="token punctuation">:</span> <span class="token string">&quot;#e6e6e6&quot;</span><span class="token punctuation">,</span>
      background<span class="token punctuation">:</span> <span class="token string">&quot;#e6e6e6&quot;</span><span class="token punctuation">,</span>
      color<span class="token punctuation">:</span> <span class="token string">&quot;#262626&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      menuColor<span class="token punctuation">:</span> <span class="token string">&quot;#ffdca3&quot;</span><span class="token punctuation">,</span>
      background<span class="token punctuation">:</span>
        <span class="token string">&quot;url(https://xxx/reader_bg_parchment_paper.jpg) center / 100% 100% fixed&quot;</span><span class="token punctuation">,</span>
      color<span class="token punctuation">:</span> <span class="token string">&quot;#4c3831&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// * 夜间模式背景数据</span>
  nightStyle<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    color<span class="token punctuation">:</span> <span class="token string">&quot;#999&quot;</span><span class="token punctuation">,</span>
    background<span class="token punctuation">:</span> <span class="token string">&quot;#222&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>然后我们在<code>reader-menu.vue</code>中，背景色这块循环<code>bgColorStyles</code>这块内容即可，然后每次我们点击色块，就修改对应的键值，如果是在<strong>夜间模式</strong>修改色块，则<strong>取消夜间模式</strong>：</p><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 省略若干内容 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>reader-menu__box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>menu-box__text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>背景<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>menu-box__item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(bgStyle, i) in bgStyleList<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item-bg<span class="token punctuation">&quot;</span></span>
               <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>i<span class="token punctuation">&quot;</span></span>
               <span class="token attr-name">:</span><span class="token style-attr language-css"><span class="token attr-name"><span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token punctuation">{</span><span class="token property">background</span><span class="token punctuation">:</span>bgStyle.menuColor<span class="token punctuation">}</span></span><span class="token punctuation">&quot;</span></span>
               <span class="token attr-name">@click.stop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>bgChange(i)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>i===bgIndex<span class="token punctuation">&quot;</span></span>
                 <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item-bg__check<span class="token punctuation">&quot;</span></span>
                 <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./assets/check.png<span class="token punctuation">&quot;</span></span>
                 <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">import</span> ReaderOptions <span class="token keyword">from</span> <span class="token string">&quot;./readerOptions.js&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      bgStyleList<span class="token punctuation">:</span> ReaderOptions<span class="token punctuation">.</span>bgColorStyles
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">bgChange</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// * 修改背景色</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>bgIndex <span class="token operator">===</span> i<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setReaderOptions</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&quot;bg&quot;</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> i <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// * 如果处于夜间模式 则切换回来</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>night<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toggleNight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;bg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>reader-menu.vue</code>这块基本就这样，然后在<code>reader-wrapper.vue</code>中修改背景色：</p><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>reader-wrapper<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wrapper<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name">:</span><span class="token style-attr language-css"><span class="token attr-name"><span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token punctuation">{</span></span>
<span class="token attr-value">         <span class="token property">fontSize</span><span class="token punctuation">:</span> fz,</span>
<span class="token attr-value">         <span class="token property">background</span><span class="token punctuation">:</span> night ? nightStyle.<span class="token property">background</span> <span class="token punctuation">:</span> bgStyleList[bgIndex].background,</span>
<span class="token attr-value">         <span class="token property">color</span><span class="token punctuation">:</span> night ? nightStyle.<span class="token property">color</span> <span class="token punctuation">:</span> bgStyleList[bgIndex].color</span>
<span class="token attr-value">        <span class="token punctuation">}</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 内容省略 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">提示</p><p>需要判断当前是否处于夜间模式，夜间模式采用夜间模式的配色</p></div><h3 id="阅读器的操作行为"><a href="#阅读器的操作行为" aria-hidden="true" class="header-anchor">#</a> 阅读器的操作行为</h3><p>根据用户点击的区域不同，阅读器会有不同的行为，比如点击右侧，则滑入下一页，点击中心区域显示菜单等。</p><p>不同的阅读器操作行为可能略有所不同，比如在<code>iReader</code>中，阅读器的操作行为如下图：</p><img src="/assets/reader/reader02.png" alt="iReader"><p>而在<code>搜狗阅读</code>中，阅读器的操作行为如下：</p><img src="/assets/reader/reader01.png" alt="搜狗阅读"><p>大多数就是这两种了，而我们这里要实现的，就是像<code>搜狗阅读</code>这种。</p><p>一般来说，这种边界距离不会是固定的，都是根据屏幕尺寸来算的，我们在此将这这个比例设置成<code>1/4</code>，并写入配置文件<code>ReaderOptions.js</code>中：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> readerOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// * 阅读器边界</span>
  readerTap<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    tapArea<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">,</span>             <span class="token comment">// 比例</span>
    width<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>            <span class="token comment">// 阅读器的宽</span>
      window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span>
      window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>offsetWidth
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    height<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>           <span class="token comment">// 阅读器的高</span>
      window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">,</span>
      window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后我们来计算区域，我们先将<code>x</code>方向的区域计算下：</p><ul><li>左侧区域<code>x1</code>等于 <code>width * tapArea</code></li><li>右侧区域<code>x2</code>等于 <code>width - 左侧区域的x坐标</code></li></ul><p>其次就是<code>y</code>方向的区域：</p><ul><li>顶部区域<code>y1</code>等于 <code>height * tapArea</code></li><li>底部区域<code>y2</code>等于 <code>height - 顶部区域</code></li></ul><p>这样中心区域也就直接出来的。</p><p>然后<strong>左侧和左上</strong>的部分加起来就是上一页的操作区域了：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// x,y 为用户点击的坐标</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> x1 <span class="token operator">||</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> y1 <span class="token operator">&amp;&amp;</span> x <span class="token operator">&lt;</span> x2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 左边以及左上部分的区域</span>
<span class="token punctuation">}</span>
</code></pre></div><p>同样<strong>右侧和右下</strong>的部分加起来就是下一页的操作区域：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> x2 <span class="token operator">||</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> x1 <span class="token operator">&amp;&amp;</span> y <span class="token operator">&gt;</span> y2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 右边以及右下部分的区域</span>
<span class="token punctuation">}</span>
</code></pre></div><p>最后就是<strong>中心区域</strong>了：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> x1 <span class="token operator">&amp;&amp;</span> x <span class="token operator">&lt;</span> x2 <span class="token operator">&amp;&amp;</span> y <span class="token operator">&gt;</span> y1 <span class="token operator">&amp;&amp;</span> y <span class="token operator">&lt;</span> y2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 中心区域</span>
<span class="token punctuation">}</span>
</code></pre></div><p>接下来逻辑也就很简单了，无非就是菜单的显示隐藏，上一页下一页的操作，以及一些细节把控，这里就不多写了。</p><p>最终效果可扫码体验：</p><img src="/assets/reader/vue-reader.png" alt="扫码体验"><div class="tip custom-block"><p class="custom-block-title">提示</p><p>过程中代码进行过多次整理，所以这里书写的代码未必是最新的，最新的代码可查看<a href="https://github.com/ZhengXiaowei/vue-reader" target="_blank" rel="noopener noreferrer"><code>github</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div><h2 id="bugs"><a href="#bugs" aria-hidden="true" class="header-anchor">#</a> bugs</h2><ul><li>横屏下，手指水平滑动一段距离后再向其他方向滑动，则页面会卡在滑动距离那无法切换页面</li></ul><div class="warning custom-block"><p class="custom-block-title">原因</p><p>该bug出现的原因是因为在<code>touchEnd</code>中使用<code>movingDirectionX</code>来判断滑动方向，而该属性是在滑动过程中去判断，比如我水平滑动<code>100px</code>后，手指向上移动，这时候滑动距离还是<code>100px</code>，可<code>movingDirectionX</code>却没有办法获取到你的滑动方向，所以导致了该bug出现。</p><p><s>弃<code>movingDirectionX</code>改用<code>directionX</code>，不过<code>directionX</code>在<code>touchEnd</code>中获取一直为0，因为<code>directionX</code>是滚动结束后相对于开始的坐标进行判断滚动方向的，所以该属性在<code>scrollEnd</code>中才能正确获取，所以这里暂时将<code>touchEnd</code>事件改为<code>scrollEnd</code>事件，并不影响整体程序运行。</s></p><p>如果使用<code>scrollEnd</code>的话，滑动翻页则会出发两次<code>_touch</code>事件，一次是手指离开屏幕的时候，一次是进行上下页滚动的时候</p></div><div class="tip custom-block"><p class="custom-block-title">新解决</p><p>使用偏移值<code>distX</code>来判断方向，<strong>正值为从左往右</strong>，<strong>负值为从右往左</strong>，<code>0</code>为<strong>点击事件</strong></p></div><ul><li>快速跳页，会容易导致来回切换</li></ul><div class="warning custom-block"><p class="custom-block-title">原因</p><p>快速点击的情况下，在下一页还没有完全滚动结束之前，二次点击会打断当前的滚动，并且会从新计算二次点击的坐标，使系统判断二次点击的坐标属于上一页的触发位移距离，因此导致来回切换。</p></div><div class="tip custom-block"><p class="custom-block-title">解决</p><p>取消dom的绑定事件，通过方向值为<code>0</code>来判断是否是点击事件，每次点击都获取手指的触点坐标，从而进行点击翻页操作。</p></div></div><div class="page-edit"><!----><div class="last-updated"><span class="prefix">上次更新: </span><span class="time">1/23/2019, 4:37:20 PM</span></div></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/vue/sync-component.html" class="prev">
          异步组件
        </a></span><span class="next"><a href="/vue/vue-tsx.html">
          搭建vue-tsx风格的开发模板
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/6.d6543f82.js" defer></script><script src="/assets/js/app.a03d4e4f.js" defer></script>
  </body>
</html>
