(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{166:function(t,s,e){"use strict";e.r(s);var a=e(0),n=Object(a.a)({},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content"},[t._m(0),t._m(1),e("p",[t._v("之前不知道是因为腾讯云出了 bug 还是咋的，已经毕业的学生证还是可以在腾讯云上购买学生套餐，于是花了 300 不到买了 3 年的服务器，买完之后就搁置在一盘没有怎么用了。")]),e("p",[t._v("最近有想法弄点自己的小东西，需要挂载到服务器上，于是就拿出了尘封已久的服务器，搭建下环境了，也好了解下怎么简单的搭建服务器。")]),t._m(2),t._m(3),t._m(4),t._m(5),e("p",[t._v("之后会让输入密码，输入之后就登录成功了。")]),t._m(6),t._m(7),t._m(8),t._m(9),t._m(10),e("p",[t._v("然后打开浏览器，输入服务器的 ip 地址，如果出现以下界面就表示成功了：")]),e("img",{attrs:{src:t.$withBase("/assets/nginx.png")}}),e("p",[t._v("是不是很简单？")]),t._m(11),t._m(12),t._m(13),t._m(14),t._m(15),t._m(16),t._m(17),t._m(18),t._m(19),t._m(20),t._m(21),t._m(22),t._m(23),t._m(24),t._m(25),t._m(26),t._m(27),t._m(28),t._m(29),t._m(30),t._m(31),t._m(32),e("p",[t._v("这样我们访问"),e("a",{attrs:{href:"https://www.weixiaomu.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.weixiaomu.com"),e("OutboundLink")],1),t._v("或者"),e("a",{attrs:{href:"https://weixiaomu.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://weixiaomu.com"),e("OutboundLink")],1),t._v("就是变成https了。")]),e("p",[t._v("效果图如下：")]),e("img",{attrs:{src:t.$withBase("/assets/https.png")}}),e("p",[t._v("但是，如果我想普通访问域名时自动跳到https下该怎么设置？")]),t._m(33),t._m(34),t._m(35)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"nginx-服务器搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx-服务器搭建","aria-hidden":"true"}},[this._v("#")]),this._v(" nginx 服务器搭建")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言","aria-hidden":"true"}},[this._v("#")]),this._v(" 前言")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#搭建","aria-hidden":"true"}},[this._v("#")]),this._v(" 搭建")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"nginx-安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx-安装","aria-hidden":"true"}},[this._v("#")]),this._v(" nginx 安装")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("通过阿里云控制台登录控制台，或者通过本地"),s("code",[this._v("ssh")]),this._v("登录服务器：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("ssh")]),this._v(" root@server "),s("span",{attrs:{class:"token comment"}},[this._v("# server 是你服务器的ip地址")]),this._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("然后我们安装"),s("code",[this._v("nginx")]),this._v("，通过"),s("code",[this._v("yum")]),this._v("命令安装：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("yum "),s("span",{attrs:{class:"token function"}},[this._v("install")]),this._v(" -y nginx\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("等待一会后，nginx 就安装上了，然后我们启动"),s("code",[this._v("nginx")]),this._v("：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("service")]),this._v(" nginx start\n")])])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[t._v("其他命令")]),e("p",[e("code",[t._v("service nginx restart")]),t._v(" # 重启"),e("code",[t._v("nginx")]),t._v("服务\n"),e("code",[t._v("service nginx stop")]),t._v(" # 停止"),e("code",[t._v("nginx")]),t._v("服务")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"配置-https"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置-https","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置 https")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("之所以想配置"),s("code",[this._v("https")]),this._v("是因为以下几点：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("安全")]),s("li",[this._v("利于 SEO")]),s("li",[this._v("防劫持")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("因为穷，没钱购买 ssl 安全证书。。。只好用免费的了。。。这里使用的是"),s("code",[this._v("certbot-auto")]),this._v("免费生成密钥。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("首先安装"),s("code",[this._v("certbot-auto")]),this._v("：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("wget")]),this._v(" https://dl.eff.org/certbot-auto\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("安装结束后，我们修改下"),s("code",[this._v("certbot-auto")]),this._v("所在目录的权限并暂时关闭"),s("code",[this._v("nginx")]),this._v("服务：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("chown")]),this._v(" a+x ./certbot-auto\n"),s("span",{attrs:{class:"token function"}},[this._v("service")]),this._v(" nginx stop\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("然后我们使用"),s("code",[this._v("certbot-auto")]),this._v("生成证书，生成证书有两种模式：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("standalone")]),s("li",[this._v("webroot")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[t._v("区别")]),e("p",[t._v("使用"),e("code",[t._v("standalone")]),t._v("模式生成的证书，如果到期后，更新证书需要重启服务，而"),e("code",[t._v("webroot")]),t._v("模式不需要，因为"),e("code",[t._v("webroot")]),t._v("模式会在项目目录下生成一个隐藏的文件，并且通过这个隐藏文件来验证，所以到期更新证书的时候不需要重启服务。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("使用 standalone 生成证书")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("./certbot-auto certonly --standalone --email 邮箱地址 -d 域名1\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[this._v("提示")]),s("p",[this._v("如果多个域名，直接后面接连跟着 -d 域名地址，比如:"),s("code",[this._v("./certbot-auto certonly --standalone -d 域名1 -d 域名2")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("使用 webroot 生成证书")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("./certbot-auto certonly --webroot --email 邮箱地址 -w 项目地址 -d 域名1 -d 域名2\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("生成后的证书会存在"),s("code",[this._v("/etc/letsencrypt/live/你的域名/")]),this._v("这个目录中。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("最后一步就是配置"),s("code",[this._v("nginx")]),this._v("：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("vim /etc/nginx/nginx.conf  "),s("span",{attrs:{class:"token comment"}},[this._v("# 打开nginx的配置文件")]),this._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在"),s("code",[this._v("server")]),this._v("中配置"),s("code",[this._v("ssl")]),this._v("：")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("server "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen       443 ssl http2 default_server"),e("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    listen       "),e("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("::"),e("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":443 ssl http2 default_server"),e("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server_name  www.weixiaomu.com weixiaomu.com"),e("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{attrs:{class:"token comment"}},[t._v("# 域名绑定")]),t._v("\n    root         /var/www/html/blog"),e("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),e("span",{attrs:{class:"token comment"}},[t._v("# 项目目录")]),t._v("\n\n    "),e("span",{attrs:{class:"token comment"}},[t._v("# 证书配置")]),t._v("\n    ssl on"),e("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ssl_certificate "),e("span",{attrs:{class:"token string"}},[t._v('"/etc/letsencrypt/live/www.weixiaomu.com/fullchain.pem"')]),e("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ssl_certificate_key "),e("span",{attrs:{class:"token string"}},[t._v('"/etc/letsencrypt/live/www.weixiaomu.com/privkey.pem"')]),e("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{attrs:{class:"token comment"}},[t._v("# Load configuration files for the default server block.")]),t._v("\n    include /etc/nginx/default.d/*.conf"),e("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    location / "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("配置好后使用"),s("code",[this._v("service nginx start")]),this._v("重启"),s("code",[this._v("nginx")]),this._v("就可以了。")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[t._v("不难，我们在"),e("code",[t._v("nginx")]),t._v("配置文件中，新建立一个"),e("code",[t._v("server")]),t._v("，当访问"),e("code",[t._v("http")]),t._v("的时候，重定向到"),e("code",[t._v("https")]),t._v("即可：")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("server "),e("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen  80"),e("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server_name     weixiaomu.com"),e("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v("  301 https://"),e("span",{attrs:{class:"token variable"}},[t._v("$server_name")]),e("span",{attrs:{class:"token variable"}},[t._v("$request_uri")]),e("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("然后重启下"),s("code",[this._v("nginx")]),this._v("就可以了。")])}],!1,null,null,null);s.default=n.exports}}]);